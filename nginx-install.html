<!DOCTYPE HTML>
<html lang="zh-CN">
<head><meta name="generator" content="Hexo 3.8.0">
    <!--Setting-->
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1">
    <meta http-equiv="Cache-Control" content="no-siteapp">
    <meta http-equiv="Cache-Control" content="no-transform">
    <meta name="renderer" content="webkit|ie-comp|ie-stand">
    <meta name="apple-mobile-web-app-capable" content="云运维">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="format-detection" content="telephone=no,email=no,adress=no">
    <meta name="browsermode" content="application">
    <meta name="screen-orientation" content="portrait">
    <link rel="dns-prefetch" href="https://www.172173.com">
    <!--SEO-->

    <meta name="keywords" content="{{ page.keywords }}">


    <meta name="description" content="
wriren by: CQhttps://www.920430.comwriren time: 2017-7-4 15:52:2
Building nginx from Sources
htt...">



<meta name="robots" content="all">
<meta name="google" content="all">
<meta name="googlebot" content="all">
<meta name="verify" content="all">

    <!--Title-->


<title>nginx-install | 云运维</title>


    <link rel="alternate" href="/atom.xml" title="云运维" type="application/atom+xml">


    <link rel="icon" href="/favicon.ico">

    



<link rel="stylesheet" href="/css/bootstrap.min.css?rev=3.3.7">
<link rel="stylesheet" href="/css/font-awesome.min.css?rev=4.5.0">
<link rel="stylesheet" href="/css/style.css?rev=@@hash">




    
	<div class="hide">
		<script type="text/javascript">
			var cnzz_protocol = (("https:" == document.location.protocol) ? " https://" : " http://");document.write(unescape("%3Cspan class='cnzz_stat_icon_1263868967 hide' %3E%3Cscript%20src%3D%22https%3A%2F%2Fs95.cnzz.com%2Fz_stat.php%3Fweb_id%3D1272564536%22%3E%3C%2Fscript%3E%3C/span%3E%3Cscript src='" + cnzz_protocol + "s19.cnzz.com/z_stat.php%3Fid%3D1263868967%26show%3Dpic1' type='text/javascript'%3E%3C/script%3E"));
		</script>
	</div>





	<script>
		(function(i, s, o, g, r, a, m) {
		    i['GoogleAnalyticsObject'] = r;
		    i[r] = i[r] || function() {
		        (i[r].q = i[r].q || []).push(arguments)
		    }, i[r].l = 1 * new Date();
		    a = s.createElement(o),
		    m = s.getElementsByTagName(o)[0];
		    a.async = 1;
		    a.src = g;
		    m.parentNode.insertBefore(a, m)
		})(window, document, 'script', 'https://www.google-analytics.com/analytics.js', 'ga');
		ga('create', 'UA-139064963-1', 'auto');
		ga('send', 'pageview');
	</script>


    

    <script>
        (function(){
            var bp = document.createElement('script');
            var curProtocol = window.location.protocol.split(':')[0];
            if (curProtocol === 'https') {
                bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';
            }
            else {
                bp.src = 'http://push.zhanzhang.baidu.com/push.js';
            }
            var s = document.getElementsByTagName("script")[0];
            s.parentNode.insertBefore(bp, s);
        })();
    </script>

    <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
    <script>
      (adsbygoogle = window.adsbygoogle || []).push({
          google_ad_client: "ca-pub-7288533661448713",
          enable_page_level_ads: true
      });
    </script>
</head>

</html>
<!--[if lte IE 8]>
<style>
    html{ font-size: 1em }
</style>
<![endif]-->
<!--[if lte IE 9]>
<div style="ie">你使用的浏览器版本过低，为了你更好的阅读体验，请更新浏览器的版本或者使用其他现代浏览器，比如Chrome、Firefox、Safari等。</div>
<![endif]-->

<body>
    <header class="main-header" style="background-image:url(https://res.cloudinary.com/www-172173-com/image/upload/v1556197753/banner_y3vilj.jpg)">
    <div class="main-header-box">
        <a class="header-avatar" href="/" title="zj">
            <img src="/img/avatar.jpg" alt="logo头像" class="img-responsive center-block">
        </a>
        <div class="branding">
        	<!--<h2 class="text-hide">Snippet主题,从未如此简单有趣</h2>-->
            
                <h2> 越努力越幸运 </h2>
            
    	</div>
    </div>
</header>
    <nav class="main-navigation">
    <div class="container">
        <div class="row">
            <div class="col-sm-12">
                <div class="navbar-header"><span class="nav-toggle-button collapsed pull-right" data-toggle="collapse" data-target="#main-menu" id="mnav">
                    <span class="sr-only"></span>
                        <i class="fa fa-bars"></i>
                    </span>
                    <a class="navbar-brand" href="https://www.172173.com">云运维</a>
                </div>
                <div class="collapse navbar-collapse" id="main-menu">
                    <ul class="menu">
                        
                            <li role="presentation" class="text-center">
                                <a href="/"><i class="fa "></i>首页</a>
                            </li>
                        
                            <li role="presentation" class="text-center">
                                <a href="/categories/运维/"><i class="fa "></i>运维</a>
                            </li>
                        
                            <li role="presentation" class="text-center">
                                <a href="/categories/python/"><i class="fa "></i>Python</a>
                            </li>
                        
                            <li role="presentation" class="text-center">
                                <a href="/categories/django/"><i class="fa "></i>Django</a>
                            </li>
                        
                            <li role="presentation" class="text-center">
                                <a href="/categories/自动化/"><i class="fa "></i>自动化</a>
                            </li>
                        
                            <li role="presentation" class="text-center">
                                <a href="/categories/工具/"><i class="fa "></i>工具</a>
                            </li>
                        
                            <li role="presentation" class="text-center">
                                <a href="/archives/"><i class="fa "></i>时间轴</a>
                            </li>
                        
                    </ul>
                </div>
            </div>
        </div>
    </div>
</nav>
    <section class="content-wrap">
        <div class="container">
            <div class="row">
                <main class="col-md-8 main-content m-post">
                    <p id="process"></p>
<article class="post">
    <div class="post-head">
        <h1 id="nginx-install">
            
	            nginx-install
            
        </h1>
        <div class="post-meta">
    
        <span class="categories-meta fa-wrap">
            <i class="fa fa-folder-open-o"></i>
            <a class="category-link" href="/categories/运维/">运维</a>
        </span>
    

    
        <span class="fa-wrap">
            <i class="fa fa-tags"></i>
            <span class="tags-meta">
                
                    <a class="tag-link" href="/tags/nginx-install/">nginx install</a>
                
            </span>
        </span>
    

    
        
        <span class="fa-wrap">
            <i class="fa fa-clock-o"></i>
            <span class="date-meta">2019/04/26</span>
        </span>
        
            <span class="fa-wrap">
                <i class="fa fa-eye"></i>
                <span id="busuanzi_value_page_pv"></span>
            </span>
        
    
</div>
            
            
    </div>
    
    <div class="post-body post-content">
        <hr>
<p><strong><em>wriren by: CQ</em></strong><br><strong><em><a href="https://www.920430.com">https://www.920430.com</a></em></strong><br><strong><em>wriren time: 2017-7-4 15:52:2</em></strong></p>
<h2 id="Building-nginx-from-Sources"><a href="#Building-nginx-from-Sources" class="headerlink" title="Building nginx from Sources"></a><strong>Building nginx from Sources</strong></h2><blockquote>
<p><a href="http://nginx.org/en/docs/configure.html">http://nginx.org/en/docs/configure.html</a></p>
</blockquote>
<ul>
<li><p>下载对应版本的源码包。</p>
<pre><code>$ cd /usr/local/src
$ sudo wget http://nginx.org/download/nginx-1.12.0.tar.gz
$ sudo wget https://ftp.pcre.org/pub/pcre/pcre-8.40.tar.gz
$ sudo wget http://zlib.net/zlib-1.2.11.tar.gz
</code></pre></li>
<li><p>同级目录解压。</p>
<pre><code>$ sudo tar xf nginx-1.12.0.tar.gz
$ sudo tar xf pcre-8.40.tar.gz
$ sudo tar xf zlib-1.2.11.tar.gz
</code></pre></li>
<li><p>安装相关的编译依赖包</p>
<pre><code>$ sudo apt-get -y install autoconf automake build-essential pkg-config \
    libperl-dev libxml2 libxslt1-dev libgeoip-dev zlib1g-dev
</code></pre></li>
<li><p>创建nginx用户,并禁止其登陆</p>
<pre><code>$ sudo useradd -s /sbin/nologin nginx
</code></pre></li>
<li><p>编译安装</p>
<pre><code> $ sudo cd /usr/local/src/nginx-1.12.0
 $ sudo ./configure --user=nginx --group=nginx \
     --prefix=/usr/local/nginx-1.12.0 \
     --conf-path=/usr/local/nginx-1.12.0/conf/nginx.conf \
     --pid-path=/var/log/nginx/nginx.pid \
     --with-pcre=../pcre-8.40 \
     --with-zlib=../zlib-1.2.11 \
     --with-stream \
     --with-stream_ssl_module \
     --with-http_ssl_module \
     --with-http_v2_module \
     --with-http_geoip_module \
     --with-http_realip_module \
     --with-http_xslt_module \
     --with-file-aio \
     --with-http_perl_module \
     --with-http_auth_request_module \
     --with-http_gzip_static_module \
     --with-http_secure_link_module \
     --with-http_sub_module \
     --with-http_stub_status_module
$ sudo make &amp;&amp; make install
$ sudo ln -s /usr/local/nginx-1.12.0 /usr/local/nginx
</code></pre></li>
<li><p>调整配置文件</p>
<pre><code>$ sudo vim /usr/local/nginx/conf/nginx.conf
user                  nginx nginx;
worker_processes      auto;

## Binds worker processes to the sets of CPUs. 
## Each CPU set is represented by a bitmask of allowed CPUs. There should be a separate set defined for each of the worker processes. 
## By default, worker processes are not bound to any specific CPUs.
worker_cpu_affinity   auto;
error_log             /var/log/nginx/error.log  notice;
pid                   /var/log/nginx/nginx.pid;

## Specifies the value for maximum file descriptors that can be opened by this process.
worker_rlimit_nofile  51200;

events
{
    use epoll;

    ## Sets the maximum number of simultaneous connections that can be opened by a worker process.
    ## It should be kept in mind that this number includes all connections (e.g. connections with proxied servers, among others), not only connections with clients. Another consideration is that the actual number of simultaneous connections cannot exceed the current limit on the maximum number of open files, which can be changed by worker_rlimit_nofile.

    ## maxclient = worker_processes * worker_connections / cpu_number
    worker_connections 30000;
}

http
{
    include       mime.types;
    default_type  application/octet-stream;
    log_format    weblog  &apos;$http_x_forwarded_for $remote_port &quot;$request&quot; $status [$time_local] &apos;
                        &apos;&quot;$http_user_agent&quot; &quot;$http_referer&quot; $body_bytes_sent &apos;
                        &apos;$remote_addr $gzip_ratio&apos;;

    sendfile           on;
    server_tokens      off;
    tcp_nopush         on;
    tcp_nodelay        on;
    keepalive_timeout  60;
    request_pool_size  4k;

    ## Allows accurate tuning of per-connection memory allocations. 
    ## This directive has minimal impact on performance and should not generally be used. 
    ## By default, the size is equal to 256 bytes on 32-bit platforms and 512 bytes on 64-bit platforms.
    connection_pool_size            512;

    client_header_timeout           3m;
    client_body_timeout             3m;
    send_timeout                    3m;
    client_header_buffer_size       256k;
    large_client_header_buffers     4 1024k;
    client_max_body_size            10m;
    client_body_buffer_size         256k;
    output_buffers                  4 32k;
    postpone_output                 1460;
    server_names_hash_bucket_size   128;

    fastcgi_connect_timeout        180s;
    fastcgi_send_timeout           180s;
    fastcgi_read_timeout           180s;
    fastcgi_buffer_size            2048k;
    fastcgi_buffers                4 1024k;
    fastcgi_busy_buffers_size      2048k;
    fastcgi_temp_file_write_size   2048k;

    gzip                  on;
    gzip_http_version     1.1;
    gzip_comp_level       2;
    gzip_min_length       1100;
    gzip_buffers          16 8k;
    gzip_vary             on;
    gzip_proxied          expired no-cache no-store private auth;
    gzip_types            text/plain text/css application/json text/xml application/xml application/xml+rss text/javascript application/javascript application/x-javascript;

    ## The following includes are specified for virtual hosts
    include          vhosts/*.conf;
}
</code></pre></li>
</ul>
<pre><code>server
{
    listen  443 ssl default; 
    # server_name silent.live www.silent.live blog.silent.live devops.silent.live;
    server_name silent.live www.silent.live;
    root  /data/wwwroot/silent.live/webroot;
    index index.shtml index.html;

    ssl_protocols TLSv1 TLSv1.1 TLSv1.2;
    ssl_certificate /etc/letsencrypt/live/silent.live/fullchain.pem;
    ssl_certificate_key /etc/letsencrypt/live/silent.live/privkey.pem;

    ## Specifies that server ciphers should be preferred over client ciphers when the SSLv3 and TLS protocols are used.
    ssl_prefer_server_ciphers on;
    # ssl_ciphers &quot;EECDH+AESGCM:EDH+AESGCM:AES256+EECDH:AES256+EDH&quot;;
    ssl_ciphers &apos;ECDHE-RSA-AES128-GCM-SHA256:ECDHE-ECDSA-AES128-GCM-SHA256:ECDHE-RSA-AES256-GCM-SHA384:ECDHE-ECDSA-AES256-GCM-SHA384:DHE-RSA-AES128-GCM-SHA256:DHE-DSS-AES128-GCM-SHA256:kEDH+AESGCM:ECDHE-RSA-AES128-SHA256:ECDHE-ECDSA-AES128-SHA256:ECDHE-RSA-AES128-SHA:ECDHE-ECDSA-AES128-SHA:ECDHE-RSA-AES256-SHA384:ECDHE-ECDSA-AES256-SHA384:ECDHE-RSA-AES256-SHA:ECDHE-ECDSA-AES256-SHA:DHE-RSA-AES128-SHA256:DHE-RSA-AES128-SHA:DHE-DSS-AES128-SHA256:DHE-RSA-AES256-SHA256:DHE-DSS-AES256-SHA:DHE-RSA-AES256-SHA:AES128-GCM-SHA256:AES256-GCM-SHA384:AES128-SHA256:AES256-SHA256:AES128-SHA:AES256-SHA:AES:CAMELLIA:DES-CBC3-SHA:!aNULL:!eNULL:!EXPORT:!DES:!RC4:!MD5:!PSK:!aECDH:!EDH-DSS-DES-CBC3-SHA:!EDH-RSA-DES-CBC3-SHA:!KRB5-DES-CBC3-SHA&apos;;

    ## Diffie-Hellman parameter for DHE ciphersuites, recommended 2048 bits
    ssl_dhparam /usr/local/nginx/sslkey/dh_ssl/nginx_dh_2048.pem;

    ## The special value auto (1.11.0) instructs nginx to use a list built into the OpenSSL library when using OpenSSL 1.0.2 or higher, or prime256v1 with older versions.
    ## Prior to version 1.11.0, the prime256v1 curve was used by default.
    ssl_ecdh_curve auto;

    ## This will create a cache shared between all worker processes.
    ## The cache size is specified in bytes (in this example: 50 MB).
    ## According to the Nginx documentation can 1MB store about 4000 sessions, so for this example, we can store about 200000 sessions, and we will store them for 180 minutes.
    ## If you expect more traffic, increase the cache size accordingly.
    ssl_session_timeout 1d;
    ssl_session_cache shared:SSL:50m;

    ## Requires nginx &gt;= 1.5.9
    ssl_session_tickets off;
    # ssl_session_ticket_key /usr/local/nginx/sslkey/tls_session/tls_session_ticket.key;

    ## OCSP Stapling, Requires nginx &gt;= 1.3.7
    ssl_stapling on;
    ssl_stapling_verify on;

    ## verify chain of trust of OCSP response using Root CA and Intermediate certs.
    # ssl_trusted_certificate /path/to/signed_cert_plus_intermediates;

    resolver 8.8.8.8 8.8.4.4 valid=300s;
    resolver_timeout 5s;

    ssi on; 
    ssi_silent_errors off;
    ssi_types text/shtml;

    location ~ .*\.(gif|jpg|jpeg|png|bmp|swf)$
    {   
        expires 30d;
        access_log off;
    }   

    location = /favicon.ico {
        rewrite (.*) /static/favicon.ico;
    }

    # location = /robots.txt {
    #     rewrite (.*) /static/robots.txt;
    # }

    location / {
        add_header Cache-Control no-cache;

        ## HSTS
        # add_header Strict-Transport-Security &quot;max-age=63072000; includeSubDomains; preload&quot;;
        add_header Strict-Transport-Security &quot;max-age=63072000&quot;;

        add_header X-Frame-Options DENY;
        add_header X-Content-Type-Options nosniff;
    }

error_page 404 /static/404.html;

access_log  /data/httplog/silent.live_access_ssl.log weblog;
error_log   /data/httplog/silent.live_error_ssl.log;
}
</code></pre>
    </div>
    
        <div class="reward" ontouchstart>
    <div class="reward-wrap">赏
        <div class="reward-box">
            
            
                <span class="reward-type">
                    <img class="wechat" src="../../../../img/reward-wepay.png"><b>微信打赏</b>
                </span>
            
        </div>
    </div>
    <p class="reward-tip">赞赏是不耍流氓的鼓励</p>
</div>


    
    <div class="post-footer">
        <div>
            
                转载声明：商业转载请联系作者获得授权,非商业转载请注明出处 © <a href target="_blank">Snippet</a>
            
        </div>
        <div>
            
        </div>
    </div>
</article>

<div class="article-nav prev-next-wrap clearfix">
    
        <a href="/nginx-tcp.html" class="pre-post btn btn-default" title="nginx-tcp">
            <i class="fa fa-angle-left fa-fw"></i><span class="hidden-lg">上一篇</span>
            <span class="hidden-xs">nginx-tcp</span>
        </a>
    
    
        <a href="/jenkins-install.html" class="next-post btn btn-default" title="jenkins-install">
            <span class="hidden-lg">下一篇</span>
            <span class="hidden-xs">jenkins-install</span><i class="fa fa-angle-right fa-fw"></i>
        </a>
    
</div>


<!--<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<script>
  (adsbygoogle = window.adsbygoogle || []).push({
    google_ad_client: "ca-pub-7288533661448713",
    enable_page_level_ads: true
  });
</script>
-->


    <div id="comments">
        
	
    <div id="vcomments" class="valine"></div>
    <script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script>
<script src="/assets/valine.min.js"></script>

    <script>
        new Valine({
            av: AV,
            el: '#vcomments',
            appId: 'xFcujt6m2KQvPvjBxRVRiD6R-gzGzoHsz',
            appKey: 'wn426D29iJpKjYczYLBPPCiP',
            placeholder: '说点什么吧',
            notify: false,
            verify: false,
            avatar: 'mm',
            meta: 'nick,mail'.split(','),
            pageSize: '10',
            path: window.location.pathname,
            lang: 'zh-CN'.toLowerCase()
        })
    </script>


    </div>





                </main>
                
                    <aside id="article-toc" role="navigation" class="col-md-4">
    <div class="widget">
        <h3 class="title">文章目录</h3>
        
            <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#Building-nginx-from-Sources"><span class="toc-text">Building nginx from Sources</span></a></li></ol>
        
    </div>
</aside>

                
            </div>
        </div>
    </section>
    <footer class="main-footer">
    <div class="container">
        <div class="row">
        </div>
    </div>
</footer>
<span>

<a id="back-to-top" class="icon-btn hide">
	<i class="fa fa-chevron-up"></i>
</a>



</span>
    <div class="copyright">
    <div class="container">
        <div class="row">
            <div class="col-sm-12">
                <div class="busuanzi">
    
        访问量:
        <strong id="busuanzi_value_site_pv">
            <i class="fa fa-spinner fa-spin"></i>
        </strong>
        &nbsp; | &nbsp;
        访客数:
        <strong id="busuanzi_value_site_uv">
            <i class="fa fa-spinner fa-spin"></i>
        </strong>
    
</div>

            </div>
            <div class="col-sm-12">
               
                <span>Copyright &copy; 2019
                </span> |
                 <span>
                版权所有 <a href="//beian.miit.gov.cn" class="copyright-links" target="_blank" rel="nofollow">闽IC
P备18011948号</a>
        	</span>
            </div>
        </div>
    </div>
</div>






    <script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>


<script src="/js/app.js?rev=@@hash"></script>

</body>
</html>