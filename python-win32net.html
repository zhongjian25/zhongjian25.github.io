<!DOCTYPE html>
<html>
<head><meta name="generator" content="Hexo 3.8.0">
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  
  <title>python-win32net | 云运维</title>
  
  <meta name="keywords" content="python win32net Python添加windows用户, 云运维 运维 技术 云 172173">
  
  
  <meta name="description" content="创新云技术">
  

  

  <meta name="HandheldFriendly" content="True">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <!-- meta -->
  

  <!-- link -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.css">
  
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/node-waves@0.7.6/dist/waves.min.css">
  
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.6.3/css/all.min.css">
  

  

  
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/xaoxuu/cdn-material-x@19.5/css/style.css">
  

  <script>
    function setLoadingBarProgress(num) {
      document.getElementById('loading-bar').style.width=num+"%";
    }
  </script>

  
  
  <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<script>
  (adsbygoogle = window.adsbygoogle || []).push({
    google_ad_client: "ca-pub-7288533661448713",
    enable_page_level_ads: true
  });
</script>
<!--<script>
(function(){
    var bp = document.createElement('script');
    var curProtocol = window.location.protocol.split(':')[0];
    if (curProtocol === 'https') {
        bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';
    }
    else {
        bp.src = 'http://push.zhanzhang.baidu.com/push.js';
    }
    var s = document.getElementsByTagName("script")[0];
    s.parentNode.insertBefore(bp, s);
})();
</script>-->
</head>

<body>
  
  
  <div class="cover-wrapper">
    <cover class="cover post half">
      
        
  <h1 class="title">172173.com</h1>


  <div class="m_search">
    <form name="searchform" class="form u-search-form">
      <input type="text" class="input u-search-input" placeholder>
      <i class="icon fas fa-search fa-fw"></i>
    </form>
  </div>

<div class="menu navgation">
  <ul class="h-list">
    
      
        <li>
          <a class="nav home" href="/" id="home">
            <i class="fas fa-rss fa-fw"></i>&nbsp;博文
          </a>
        </li>
      
        <li>
          <a class="nav home" href="/categories/" id="categories">
            <i class="fas fa-code-branch fa-fw"></i>&nbsp;分类
          </a>
        </li>
      
        <li>
          <a class="nav home" href="/friends/" rel="nofollow" id="friends">
            <i class="fas fa-link fa-fw"></i>&nbsp;友链
          </a>
        </li>
      
        <li>
          <a class="nav home" href="/about/" rel="nofollow" id="about">
            <i class="fas fa-info-circle fa-fw"></i>&nbsp;关于
          </a>
        </li>
      
    
  </ul>
</div>

      
    </cover>
    <header class="l_header pure">
  <div id="loading-bar-wrapper">
    <div id="loading-bar" class="pure"></div>
  </div>

	<div class="wrapper">
		<div class="nav-main container container--flex">
      <a class="logo flat-box" href="/">
        
          云运维
        
      </a>
			<div class="menu navgation">
				<ul class="h-list">
          
  					
  						<li>
								<a class="nav flat-box" href="/categories/Linux" id="categoriesLinux">
									<i class="fas fa-grin fa-fw"></i>&nbsp;Linux
								</a>
							</li>
      			
  						<li>
								<a class="nav flat-box" href="/categories/Windows" rel="nofollow" id="categoriesWindows">
									<i class="fas fa-folder-open fa-fw"></i>&nbsp;Windows
								</a>
							</li>
      			
  						<li>
								<a class="nav flat-box" href="/categories/Python" rel="nofollow" id="categoriesPython">
									<i class="fas fa-hashtag fa-fw"></i>&nbsp;Python
								</a>
							</li>
      			
  						<li>
								<a class="nav flat-box" href="/categories/工具" rel="nofollow" id="categories工具">
									<i class="fas fa-hashtag fa-fw"></i>&nbsp;工具
								</a>
							</li>
      			
  						<li>
								<a class="nav flat-box" href="/archives/" rel="nofollow" id="archives">
									<i class="fas fa-archive fa-fw"></i>&nbsp;归档
								</a>
							</li>
      			
      		
				</ul>
			</div>

			
				<div class="m_search">
					<form name="searchform" class="form u-search-form">
						<input type="text" class="input u-search-input" placeholder="搜索">
						<i class="icon fas fa-search fa-fw"></i>
					</form>
				</div>
			
			<ul class="switcher h-list">
				
					<li class="s-search"><a class="fas fa-search fa-fw" href="javascript:void(0)"></a></li>
				
				<li class="s-menu"><a class="fas fa-bars fa-fw" href="javascript:void(0)"></a></li>
			</ul>
		</div>

		<div class="nav-sub container container--flex">
			<a class="logo flat-box"></a>
			<ul class="switcher h-list">
				<li class="s-comment"><a class="flat-btn fas fa-comments fa-fw" href="javascript:void(0)"></a></li>
        
          <li class="s-toc"><a class="flat-btn fas fa-list fa-fw" href="javascript:void(0)"></a></li>
        
			</ul>
		</div>
	</div>
</header>
	<aside class="menu-phone">
    <header>
		<nav class="menu navgation">
      <ul>
        
          
            <li>
							<a class="nav flat-box" href="/" id="home">
								<i class="fas fa-clock fa-fw"></i>&nbsp;近期文章
							</a>
            </li>
          
            <li>
							<a class="nav flat-box" href="/archives/" rel="nofollow" id="archives">
								<i class="fas fa-archive fa-fw"></i>&nbsp;文章归档
							</a>
            </li>
          
            <li>
							<a class="nav flat-box" href="/categores/" id="categores">
								<i class="fas fa-code-branch fa-fw"></i>&nbsp;文档分类
							</a>
            </li>
          
            <li>
							<a class="nav flat-box" href="/friends/" rel="nofollow" id="friends">
								<i class="fas fa-link fa-fw"></i>&nbsp;我的友链
							</a>
            </li>
          
            <li>
							<a class="nav flat-box" href="https://xaoxuu.com/wiki/material-x/" rel="nofollow" id="https:xaoxuu.comwikimaterial-x">
								<i class="fas fa-book fa-fw"></i>&nbsp;主题文档
							</a>
            </li>
          
            <li>
							<a class="nav flat-box" href="/about/" rel="nofollow" id="about">
								<i class="fas fa-info-circle fa-fw"></i>&nbsp;关于小站
							</a>
            </li>
          
       
      </ul>
		</nav>
    </header>
	</aside>
<script>setLoadingBarProgress(40);</script>

  </div>


  <div class="l_body">
    <div class='body-wrapper'>
      <div class="l_main">
  

  
    <article id="post" class="post white-box article-type-post" itemscope itemprop="blogPost">
      


  <section class="meta">
    
    
    <div class="meta" id="header-meta">
      
        
  
    <h1 class="title">
      <a href="/python-win32net.html">
        python-win32net
      </a>
    </h1>
  


      
      <div class="new-meta-box">
        
          
        
          
            
  <div class="new-meta-item author">
    <a href="https://www.172173.com" rel="nofollow">
      
        <i class="fas fa-user" aria-hidden="true"></i>
      
      <p>zj</p>
    </a>
  </div>


          
        
          
            <div class="new-meta-item date">
  <a class="notlink">
    <i class="fas fa-calendar-alt" aria-hidden="true"></i>
    <p>2019-05-13</p>
  </a>
</div>

          
        
          
            
  
  <div class="new-meta-item category">
    <a href="/categories/Python/" rel="nofollow">
      <i class="fas fa-folder-open" aria-hidden="true"></i>
      <p>Python</p>
    </a>
  </div>


          
        
          
            
  
    <div class="new-meta-item browse busuanzi">
      <a class="notlink">
        <i class="fas fa-eye" aria-hidden="true"></i>
        <p>
          <span id="busuanzi_value_page_pv">
            <i class="fas fa-spinner fa-spin fa-fw" aria-hidden="true"></i>
          </span>
        </p>
      </a>
    </div>
  


          
        
          
            

          
        
      </div>
      
        <hr>
      
    </div>
  </section>


      <section class="article typo">
        <div class="article-entry" itemprop="articleBody">
          <h3 id="python-windows-用户管理"><a href="#python-windows-用户管理" class="headerlink" title="python windows 用户管理"></a>python windows 用户管理</h3><blockquote>
<p>python win32net 模块,添加系统用户，以及赋权限。<br>用于场景，VPN批量增加用户，共享增加用户，挺好用的。这边最需要注意的是赋权，是分两步走的。</p>
</blockquote>
<h3 id="第一步，创建用户"><a href="#第一步，创建用户" class="headerlink" title="第一步，创建用户"></a>第一步，创建用户</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">win32net.NetUserAdd(None, 1, udata)</span><br></pre></td></tr></table></figure>
<h3 id="第二部，加组"><a href="#第二部，加组" class="headerlink" title="第二部，加组"></a>第二部，加组</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">win32net.NetLocalGroupAddMembers(serverName, group_name, 3, [u])</span><br></pre></td></tr></table></figure>
<h3 id="第三步，赋权"><a href="#第三步，赋权" class="headerlink" title="第三步，赋权"></a>第三步，赋权</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">win32net.NetUserSetInfo(None, u_name, 4, user_info)</span><br></pre></td></tr></table></figure>
<a id="more"></a>
<h3 id="代码"><a href="#代码" class="headerlink" title="代码"></a>代码</h3><pre><code># -*- coding: utf-8 -*-

window 用户管理
.. important::
    用salt       也可以用这个模块

依赖模块
:depends:
        - pythoncom
        - pywintypes
        - win32api
        - win32con
        - win32net
        - win32netcon
        - win32profile
        - win32security
        - win32ts
        - wmi


.. note::
    目前只适用于本地用户帐户，而不是域帐户。


# Import Python libs
from __future__ import absolute_import, unicode_literals, print_function
import logging
import time
from datetime import datetime

try:
    from shlex import quote as _cmd_quote  # pylint: disable=E0611
except Exception:
    from pipes import quote as _cmd_quote

# Import Salt libs
import salt.utils.args
import salt.utils.dateutils
import salt.utils.platform
from salt.ext import six
from salt.ext.six import string_types
from salt.exceptions import CommandExecutionError

log = logging.getLogger(__name__)

try:
    import pywintypes
    import wmi
    import pythoncom
    import win32api
    import win32con
    import win32net
    import win32netcon
    import win32profile
    import win32security
    import win32ts
    HAS_WIN32NET_MODS = True
except ImportError:
    HAS_WIN32NET_MODS = False

# Define the module&apos;s virtual name
__virtualname__ = &apos;user&apos;


def __virtual__():
    &apos;&apos;&apos;
    需要Windows和Windows模块
    &apos;&apos;&apos;
    if not salt.utils.platform.is_windows():
        return False, &apos;Module win_useradd: Windows Only&apos;

    if not HAS_WIN32NET_MODS:
        return False, &apos;Module win_useradd: Missing Win32 Modules&apos;

    return __virtualname__


def _to_unicode(instr):
    &apos;&apos;&apos;
    用于转换为Unicode字符串的内部函数

    The NetUser* series of API calls in this module requires input parameters to
    be Unicode Strings. This function ensures the parameter is a Unicode String.
    This only seems to be an issue in Python 2. All calls to this function
    should be gated behind a ``if six.PY2`` check.

    Args:
        instr (str): String to convert

    Returns:
        str: Unicode type string
    &apos;&apos;&apos;
    if instr is None or isinstance(instr, six.text_type):
        return instr
    else:
        return six.text_type(instr, &apos;utf-8&apos;)


def add(name,
        password=None,
        fullname=None,
        description=None,
        groups=None,
        home=None,
        homedrive=None,
        profile=None,
        logonscript=None):
    &apos;&apos;&apos;
    添加用户

    参数:
        name (str): User name

        password (str, optional): User&apos;s password in plain text.

        fullname (str, optional): The user&apos;s full name.

        description (str, optional): A brief description of the user account.

        groups (str, optional): A list of groups to add the user to.
            (see chgroups)

        home (str, optional): The path to the user&apos;s home directory.

        homedrive (str, optional): The drive letter to assign to the home
            directory. Must be the Drive Letter followed by a colon. ie: U:

        profile (str, optional): An explicit path to a profile. Can be a UNC or
            a folder on the system. If left blank, windows uses it&apos;s default
            profile directory.

        logonscript (str, optional): Path to a login script to run when the user
            logs on.

    Returns:
        bool: True if successful. False is unsuccessful.

    CLI Example:

    .. code-block:: bash

        salt &apos;*&apos; user.add name password
    &apos;&apos;&apos;
    if six.PY2:
        name = _to_unicode(name)
        password = _to_unicode(password)
        fullname = _to_unicode(fullname)
        description = _to_unicode(description)
        home = _to_unicode(home)
        homedrive = _to_unicode(homedrive)
        profile = _to_unicode(profile)
        logonscript = _to_unicode(logonscript)

    user_info = {}
    if name:
        user_info[&apos;name&apos;] = name
    else:
        return False
    user_info[&apos;password&apos;] = password
    user_info[&apos;priv&apos;] = win32netcon.USER_PRIV_USER
    user_info[&apos;home_dir&apos;] = home
    user_info[&apos;comment&apos;] = description
    user_info[&apos;flags&apos;] = win32netcon.UF_SCRIPT
    user_info[&apos;script_path&apos;] = logonscript

    try:
        win32net.NetUserAdd(None, 1, user_info)
    except win32net.error as exc:
        log.error(&apos;Failed to create user %s&apos;, name)
        log.error(&apos;nbr: %s&apos;, exc.winerror)
        log.error(&apos;ctx: %s&apos;, exc.funcname)
        log.error(&apos;msg: %s&apos;, exc.strerror)
        return False

    update(name=name,
           homedrive=homedrive,
           profile=profile,
           fullname=fullname)

    ret = chgroups(name, groups) if groups else True

    return ret


def update(name,
           password=None,
           fullname=None,
           description=None,
           home=None,
           homedrive=None,
           logonscript=None,
           profile=None,
           expiration_date=None,
           expired=None,
           account_disabled=None,
           unlock_account=None,
           password_never_expires=None,
           disallow_change_password=None):
    # pylint: disable=anomalous-backslash-in-string
    &apos;&apos;&apos;
    更新Windows用户的设置。name是唯一必需的参数。

    只有在传递参数值时，才会更改设置。
    .. versionadded:: 2015.8.0

    Args:
        name (str): The user name to update.

        password (str, optional): New user password in plain text.

        fullname (str, optional): The user&apos;s full name.

        description (str, optional): A brief description of the user account.

        home (str, optional): The path to the user&apos;s home directory.

        homedrive (str, optional): The drive letter to assign to the home
            directory. Must be the Drive Letter followed by a colon. ie: U:

        logonscript (str, optional): The path to the logon script.

        profile (str, optional): The path to the user&apos;s profile directory.

        expiration_date (date, optional): The date and time when the account
            expires. Can be a valid date/time string. To set to never expire
            pass the string &apos;Never&apos;.

        expired (bool, optional): Pass `True` to expire the account. The user
            will be prompted to change their password at the next logon. Pass
            `False` to mark the account as &apos;not expired&apos;. You can&apos;t use this to
            negate the expiration if the expiration was caused by the account
            expiring. You&apos;ll have to change the `expiration_date` as well.

        account_disabled (bool, optional): True disables the account. False
            enables the account.

        unlock_account (bool, optional): True unlocks a locked user account.
            False is ignored.

        password_never_expires (bool, optional): True sets the password to never
            expire. False allows the password to expire.

        disallow_change_password (bool, optional): True blocks the user from
            changing the password. False allows the user to change the password.

    Returns:
        bool: True if successful. False is unsuccessful.

    CLI Example:

    .. code-block:: bash

        salt &apos;*&apos; user.update bob password=secret profile=C:\\Users\\Bob
                 home=\\server\homeshare\bob homedrive=U:
    &apos;&apos;&apos;
    # pylint: enable=anomalous-backslash-in-string
    if six.PY2:
        name = _to_unicode(name)
        password = _to_unicode(password)
        fullname = _to_unicode(fullname)
        description = _to_unicode(description)
        home = _to_unicode(home)
        homedrive = _to_unicode(homedrive)
        logonscript = _to_unicode(logonscript)
        profile = _to_unicode(profile)

    # Make sure the user exists
    # Return an object containing current settings for the user
    try:
        user_info = win32net.NetUserGetInfo(None, name, 4)
    except win32net.error as exc:
        log.error(&apos;Failed to update user %s&apos;, name)
        log.error(&apos;nbr: %s&apos;, exc.winerror)
        log.error(&apos;ctx: %s&apos;, exc.funcname)
        log.error(&apos;msg: %s&apos;, exc.strerror)
        return False

    # Check parameters to update
    # Update the user object with new settings
    if password:
        user_info[&apos;password&apos;] = password
    if home:
        user_info[&apos;home_dir&apos;] = home
    if homedrive:
        user_info[&apos;home_dir_drive&apos;] = homedrive
    if description:
        user_info[&apos;comment&apos;] = description
    if logonscript:
        user_info[&apos;script_path&apos;] = logonscript
    if fullname:
        user_info[&apos;full_name&apos;] = fullname
    if profile:
        user_info[&apos;profile&apos;] = profile
    if expiration_date:
        if expiration_date == &apos;Never&apos;:
            user_info[&apos;acct_expires&apos;] = win32netcon.TIMEQ_FOREVER
        else:
            try:
                dt_obj = salt.utils.dateutils.date_cast(expiration_date)
            except (ValueError, RuntimeError):
                return &apos;Invalid Date/Time Format: {0}&apos;.format(expiration_date)
            user_info[&apos;acct_expires&apos;] = time.mktime(dt_obj.timetuple())
    if expired is not None:
        if expired:
            user_info[&apos;password_expired&apos;] = 1
        else:
            user_info[&apos;password_expired&apos;] = 0
    if account_disabled is not None:
        if account_disabled:
            user_info[&apos;flags&apos;] |= win32netcon.UF_ACCOUNTDISABLE
        else:
            user_info[&apos;flags&apos;] &amp;= ~win32netcon.UF_ACCOUNTDISABLE
    if unlock_account is not None:
        if unlock_account:
            user_info[&apos;flags&apos;] &amp;= ~win32netcon.UF_LOCKOUT
    if password_never_expires is not None:
        if password_never_expires:
            user_info[&apos;flags&apos;] |= win32netcon.UF_DONT_EXPIRE_PASSWD
        else:
            user_info[&apos;flags&apos;] &amp;= ~win32netcon.UF_DONT_EXPIRE_PASSWD
    if disallow_change_password is not None:
        if disallow_change_password:
            user_info[&apos;flags&apos;] |= win32netcon.UF_PASSWD_CANT_CHANGE
        else:
            user_info[&apos;flags&apos;] &amp;= ~win32netcon.UF_PASSWD_CANT_CHANGE

    # Apply new settings
    try:
        win32net.NetUserSetInfo(None, name, 4, user_info)
    except win32net.error as exc:
        log.error(&apos;Failed to update user %s&apos;, name)
        log.error(&apos;nbr: %s&apos;, exc.winerror)
        log.error(&apos;ctx: %s&apos;, exc.funcname)
        log.error(&apos;msg: %s&apos;, exc.strerror)
        return False

    return True


def delete(name,
           purge=False,
           force=False):
    &apos;&apos;&apos;
    删除用户

    Args:
        name (str): The name of the user to delete

        purge (bool, optional): Boolean value indicating that the user profile
            should also be removed when the user account is deleted. If set to
            True the profile will be removed. Default is False.

        force (bool, optional): Boolean value indicating that the user account
            should be deleted even if the user is logged in. True will log the
            user out and delete user.

    Returns:
        bool: True if successful, otherwise False

    CLI Example:

    .. code-block:: bash

        salt &apos;*&apos; user.delete name
    &apos;&apos;&apos;
    if six.PY2:
        name = _to_unicode(name)

    # Check if the user exists
    try:
        user_info = win32net.NetUserGetInfo(None, name, 4)
    except win32net.error as exc:
        log.error(&apos;User not found: %s&apos;, name)
        log.error(&apos;nbr: %s&apos;, exc.winerror)
        log.error(&apos;ctx: %s&apos;, exc.funcname)
        log.error(&apos;msg: %s&apos;, exc.strerror)
        return False

    # Check if the user is logged in
    # Return a list of logged in users
    try:
        sess_list = win32ts.WTSEnumerateSessions()
    except win32ts.error as exc:
        log.error(&apos;No logged in users found&apos;)
        log.error(&apos;nbr: %s&apos;, exc.winerror)
        log.error(&apos;ctx: %s&apos;, exc.funcname)
        log.error(&apos;msg: %s&apos;, exc.strerror)

    # Is the user one that is logged in
    logged_in = False
    session_id = None
    for sess in sess_list:
        if win32ts.WTSQuerySessionInformation(None, sess[&apos;SessionId&apos;], win32ts.WTSUserName) == name:
            session_id = sess[&apos;SessionId&apos;]
            logged_in = True

    # If logged in and set to force, log the user out and continue
    # If logged in and not set to force, return false
    if logged_in:
        if force:
            try:
                win32ts.WTSLogoffSession(win32ts.WTS_CURRENT_SERVER_HANDLE, session_id, True)
            except win32ts.error as exc:
                log.error(&apos;User not found: %s&apos;, name)
                log.error(&apos;nbr: %s&apos;, exc.winerror)
                log.error(&apos;ctx: %s&apos;, exc.funcname)
                log.error(&apos;msg: %s&apos;, exc.strerror)
                return False
        else:
            log.error(&apos;User %s is currently logged in.&apos;, name)
            return False

    # Remove the User Profile directory
    if purge:
        try:
            sid = getUserSid(name)
            win32profile.DeleteProfile(sid)
        except pywintypes.error as exc:
            (number, context, message) = exc.args
            if number == 2:  # Profile Folder Not Found
                pass
            else:
                log.error(&apos;Failed to remove profile for %s&apos;, name)
                log.error(&apos;nbr: %s&apos;, exc.winerror)
                log.error(&apos;ctx: %s&apos;, exc.funcname)
                log.error(&apos;msg: %s&apos;, exc.strerror)
                return False

    # And finally remove the user account
    try:
        win32net.NetUserDel(None, name)
    except win32net.error as exc:
        log.error(&apos;Failed to delete user %s&apos;, name)
        log.error(&apos;nbr: %s&apos;, exc.winerror)
        log.error(&apos;ctx: %s&apos;, exc.funcname)
        log.error(&apos;msg: %s&apos;, exc.strerror)
        return False

    return True


def getUserSid(username):
    &apos;&apos;&apos;
    获取 用户安全ID 


    Args:
        username (str): The user name for which to look up the SID

    Returns:
        str: The user SID

    CLI Example:

    .. code-block:: bash

        salt &apos;*&apos; user.getUserSid jsnuffy
    &apos;&apos;&apos;
    if six.PY2:
        username = _to_unicode(username)

    domain = win32api.GetComputerName()
    if username.find(&apos;\\&apos;) != -1:
        domain = username.split(&apos;\\&apos;)[0]
        username = username.split(&apos;\\&apos;)[-1]
    domain = domain.upper()
    return win32security.ConvertSidToStringSid(
        win32security.LookupAccountName(None, domain + &apos;\\&apos; + username)[0])


def setpassword(name, password):
    &apos;&apos;&apos;
    设置密码

    Args:
        name (str): The user name for which to set the password

        password (str): The new password

    Returns:
        bool: True if successful, otherwise False

    CLI Example:

    .. code-block:: bash

        salt &apos;*&apos; user.setpassword jsnuffy sup3rs3cr3t
    &apos;&apos;&apos;
    return update(name=name, password=password)


def addgroup(name, group):
    &apos;&apos;&apos;
    添加用户到组

    Args:
        name (str): The user name to add to the group

        group (str): The name of the group to which to add the user

    Returns:
        bool: True if successful, otherwise False

    CLI Example:

    .. code-block:: bash

        salt &apos;*&apos; user.addgroup jsnuffy &apos;Power Users&apos;
    &apos;&apos;&apos;
    if six.PY2:
        name = _to_unicode(name)
        group = _to_unicode(group)

    name = _cmd_quote(name)
    group = _cmd_quote(group).lstrip(&apos;\&apos;&apos;).rstrip(&apos;\&apos;&apos;)

    user = info(name)
    if not user:
        return False
    if group in user[&apos;groups&apos;]:
        return True

    cmd = &apos;net localgroup &quot;{0}&quot; {1} /add&apos;.format(group, name)
    ret = __salt__[&apos;cmd.run_all&apos;](cmd, python_shell=True)

    return ret[&apos;retcode&apos;] == 0


def removegroup(name, group):
    &apos;&apos;&apos;
    把用户从组中移除

    Args:
        name (str): The user name to remove from the group

        group (str): The name of the group from which to remove the user

    Returns:
        bool: True if successful, otherwise False

    CLI Example:

    .. code-block:: bash

        salt &apos;*&apos; user.removegroup jsnuffy &apos;Power Users&apos;
    &apos;&apos;&apos;
    if six.PY2:
        name = _to_unicode(name)
        group = _to_unicode(group)

    name = _cmd_quote(name)
    group = _cmd_quote(group).lstrip(&apos;\&apos;&apos;).rstrip(&apos;\&apos;&apos;)

    user = info(name)

    if not user:
        return False

    if group not in user[&apos;groups&apos;]:
        return True

    cmd = &apos;net localgroup &quot;{0}&quot; {1} /delete&apos;.format(group, name)
    ret = __salt__[&apos;cmd.run_all&apos;](cmd, python_shell=True)

    return ret[&apos;retcode&apos;] == 0


def chhome(name, home, **kwargs):
    &apos;&apos;&apos;
    更改家目录

    Args:
        name (str): The name of the user whose home directory you wish to change

        home (str): The new location of the home directory

    Returns:
        bool: True if successful, otherwise False

    CLI Example:

    .. code-block:: bash

        salt &apos;*&apos; user.chhome foo \\\\fileserver\\home\\foo True
    &apos;&apos;&apos;
    if six.PY2:
        name = _to_unicode(name)
        home = _to_unicode(home)

    kwargs = salt.utils.args.clean_kwargs(**kwargs)
    persist = kwargs.pop(&apos;persist&apos;, False)
    if kwargs:
        salt.utils.args.invalid_kwargs(kwargs)
    if persist:
        log.info(&apos;Ignoring unsupported \&apos;persist\&apos; argument to user.chhome&apos;)

    pre_info = info(name)

    if not pre_info:
        return False

    if home == pre_info[&apos;home&apos;]:
        return True

    if not update(name=name, home=home):
        return False

    post_info = info(name)
    if post_info[&apos;home&apos;] != pre_info[&apos;home&apos;]:
        return post_info[&apos;home&apos;] == home

    return False


def chprofile(name, profile):
    &apos;&apos;&apos;
    修改配置文件目录

    Args:
        name (str): The name of the user whose profile you wish to change

        profile (str): The new location of the profile

    Returns:
        bool: True if successful, otherwise False

    CLI Example:

    .. code-block:: bash

        salt &apos;*&apos; user.chprofile foo \\\\fileserver\\profiles\\foo
    &apos;&apos;&apos;
    return update(name=name, profile=profile)


def chfullname(name, fullname):
    &apos;&apos;&apos;
    修改全名
    Args:
        name (str): The user name for which to change the full name

        fullname (str): The new value for the full name

    Returns:
        bool: True if successful, otherwise False

    CLI Example:

    .. code-block:: bash

        salt &apos;*&apos; user.chfullname user &apos;First Last&apos;
    &apos;&apos;&apos;
    return update(name=name, fullname=fullname)


def chgroups(name, groups, append=True):
    &apos;&apos;&apos;
    Change the groups this user belongs to, add append=False to make the user a
    member of only the specified groups

    Args:
        name (str): The user name for which to change groups

        groups (str, list): A single group or a list of groups to assign to the
            user. For multiple groups this can be a comma delimited string or a
            list.

        append (bool, optional): True adds the passed groups to the user&apos;s
            current groups. False sets the user&apos;s groups to the passed groups
            only. Default is True.

    Returns:
        bool: True if successful, otherwise False

    CLI Example:

    .. code-block:: bash

        salt &apos;*&apos; user.chgroups jsnuffy Administrators,Users True
    &apos;&apos;&apos;
    if six.PY2:
        name = _to_unicode(name)

    if isinstance(groups, string_types):
        groups = groups.split(&apos;,&apos;)

    groups = [x.strip(&apos; *&apos;) for x in groups]
    if six.PY2:
        groups = [_to_unicode(x) for x in groups]

    ugrps = set(list_groups(name))
    if ugrps == set(groups):
        return True

    name = _cmd_quote(name)

    if not append:
        for group in ugrps:
            group = _cmd_quote(group).lstrip(&apos;\&apos;&apos;).rstrip(&apos;\&apos;&apos;)
            if group not in groups:
                cmd = &apos;net localgroup &quot;{0}&quot; {1} /delete&apos;.format(group, name)
                __salt__[&apos;cmd.run_all&apos;](cmd, python_shell=True)

    for group in groups:
        if group in ugrps:
            continue
        group = _cmd_quote(group).lstrip(&apos;\&apos;&apos;).rstrip(&apos;\&apos;&apos;)
        cmd = &apos;net localgroup &quot;{0}&quot; {1} /add&apos;.format(group, name)
        out = __salt__[&apos;cmd.run_all&apos;](cmd, python_shell=True)
        if out[&apos;retcode&apos;] != 0:
            log.error(out[&apos;stdout&apos;])
            return False

    agrps = set(list_groups(name))
    return len(ugrps - agrps) == 0


def info(name):
    &apos;&apos;&apos;
    Return user information

    Args:
        name (str): Username for which to display information

    Returns:
        dict: A dictionary containing user information
            - fullname
            - username
            - SID
            - passwd (will always return None)
            - comment (same as description, left here for backwards compatibility)
            - description
            - active
            - logonscript
            - profile
            - home
            - homedrive
            - groups
            - password_changed
            - successful_logon_attempts
            - failed_logon_attempts
            - last_logon
            - account_disabled
            - account_locked
            - password_never_expires
            - disallow_change_password
            - gid

    CLI Example:

    .. code-block:: bash

        salt &apos;*&apos; user.info jsnuffy
    &apos;&apos;&apos;
    if six.PY2:
        name = _to_unicode(name)

    ret = {}
    items = {}
    try:
        items = win32net.NetUserGetInfo(None, name, 4)
    except win32net.error:
        pass

    if items:
        groups = []
        try:
            groups = win32net.NetUserGetLocalGroups(None, name)
        except win32net.error:
            pass

        ret[&apos;fullname&apos;] = items[&apos;full_name&apos;]
        ret[&apos;name&apos;] = items[&apos;name&apos;]
        ret[&apos;uid&apos;] = win32security.ConvertSidToStringSid(items[&apos;user_sid&apos;])
        ret[&apos;passwd&apos;] = items[&apos;password&apos;]
        ret[&apos;comment&apos;] = items[&apos;comment&apos;]
        ret[&apos;description&apos;] = items[&apos;comment&apos;]
        ret[&apos;active&apos;] = (not bool(items[&apos;flags&apos;] &amp; win32netcon.UF_ACCOUNTDISABLE))
        ret[&apos;logonscript&apos;] = items[&apos;script_path&apos;]
        ret[&apos;profile&apos;] = items[&apos;profile&apos;]
        ret[&apos;failed_logon_attempts&apos;] = items[&apos;bad_pw_count&apos;]
        ret[&apos;successful_logon_attempts&apos;] = items[&apos;num_logons&apos;]
        secs = time.mktime(datetime.now().timetuple()) - items[&apos;password_age&apos;]
        ret[&apos;password_changed&apos;] = datetime.fromtimestamp(secs). \
            strftime(&apos;%Y-%m-%d %H:%M:%S&apos;)
        if items[&apos;last_logon&apos;] == 0:
            ret[&apos;last_logon&apos;] = &apos;Never&apos;
        else:
            ret[&apos;last_logon&apos;] = datetime.fromtimestamp(items[&apos;last_logon&apos;]).\
                strftime(&apos;%Y-%m-%d %H:%M:%S&apos;)
        ret[&apos;expiration_date&apos;] = datetime.fromtimestamp(items[&apos;acct_expires&apos;]).\
            strftime(&apos;%Y-%m-%d %H:%M:%S&apos;)
        ret[&apos;expired&apos;] = items[&apos;password_expired&apos;] == 1
        if not ret[&apos;profile&apos;]:
            ret[&apos;profile&apos;] = _get_userprofile_from_registry(name, ret[&apos;uid&apos;])
        ret[&apos;home&apos;] = items[&apos;home_dir&apos;]
        ret[&apos;homedrive&apos;] = items[&apos;home_dir_drive&apos;]
        if not ret[&apos;home&apos;]:
            ret[&apos;home&apos;] = ret[&apos;profile&apos;]
        ret[&apos;groups&apos;] = groups
        if items[&apos;flags&apos;] &amp; win32netcon.UF_DONT_EXPIRE_PASSWD == 0:
            ret[&apos;password_never_expires&apos;] = False
        else:
            ret[&apos;password_never_expires&apos;] = True
        if items[&apos;flags&apos;] &amp; win32netcon.UF_ACCOUNTDISABLE == 0:
            ret[&apos;account_disabled&apos;] = False
        else:
            ret[&apos;account_disabled&apos;] = True
        if items[&apos;flags&apos;] &amp; win32netcon.UF_LOCKOUT == 0:
            ret[&apos;account_locked&apos;] = False
        else:
            ret[&apos;account_locked&apos;] = True
        if items[&apos;flags&apos;] &amp; win32netcon.UF_PASSWD_CANT_CHANGE == 0:
            ret[&apos;disallow_change_password&apos;] = False
        else:
            ret[&apos;disallow_change_password&apos;] = True

        ret[&apos;gid&apos;] = &apos;&apos;

        return ret

    else:

        return {}


def _get_userprofile_from_registry(user, sid):
    &apos;&apos;&apos;
    In case net user doesn&apos;t return the userprofile we can get it from the
    registry

    Args:
        user (str): The user name, used in debug message

        sid (str): The sid to lookup in the registry

    Returns:
        str: Profile directory
    &apos;&apos;&apos;
    profile_dir = __salt__[&apos;reg.read_value&apos;](
        &apos;HKEY_LOCAL_MACHINE&apos;,
        &apos;SOFTWARE\\Microsoft\\Windows NT\\CurrentVersion\\ProfileList\\{0}&apos;.format(sid),
        &apos;ProfileImagePath&apos;
    )[&apos;vdata&apos;]
    log.debug(
        &apos;user %s with sid=%s profile is located at &quot;%s&quot;&apos;,
        user, sid, profile_dir
    )
    return profile_dir


def list_groups(name):
    &apos;&apos;&apos;
    Return a list of groups the named user belongs to

    Args:
        name (str): The user name for which to list groups

    Returns:
        list: A list of groups to which the user belongs

    CLI Example:

    .. code-block:: bash

        salt &apos;*&apos; user.list_groups foo
    &apos;&apos;&apos;
    if six.PY2:
        name = _to_unicode(name)

    ugrp = set()
    try:
        user = info(name)[&apos;groups&apos;]
    except KeyError:
        return False
    for group in user:
        ugrp.add(group.strip(&apos; *&apos;))

    return sorted(list(ugrp))


def getent(refresh=False):
    &apos;&apos;&apos;
    Return the list of all info for all users

    Args:
        refresh (bool, optional): Refresh the cached user information. Useful
            when used from within a state function. Default is False.

    Returns:
        dict: A dictionary containing information about all users on the system

    CLI Example:

    .. code-block:: bash

        salt &apos;*&apos; user.getent
    &apos;&apos;&apos;
    if &apos;user.getent&apos; in __context__ and not refresh:
        return __context__[&apos;user.getent&apos;]

    ret = []
    for user in __salt__[&apos;user.list_users&apos;]():
        stuff = {}
        user_info = __salt__[&apos;user.info&apos;](user)

        stuff[&apos;gid&apos;] = &apos;&apos;
        stuff[&apos;groups&apos;] = user_info[&apos;groups&apos;]
        stuff[&apos;home&apos;] = user_info[&apos;home&apos;]
        stuff[&apos;name&apos;] = user_info[&apos;name&apos;]
        stuff[&apos;passwd&apos;] = user_info[&apos;passwd&apos;]
        stuff[&apos;shell&apos;] = &apos;&apos;
        stuff[&apos;uid&apos;] = user_info[&apos;uid&apos;]

        ret.append(stuff)

    __context__[&apos;user.getent&apos;] = ret
    return ret


def list_users():
    &apos;&apos;&apos;
    Return a list of all users on Windows

    Returns:
        list: A list of all users on the system

    CLI Example:

    .. code-block:: bash

        salt &apos;*&apos; user.list_users
    &apos;&apos;&apos;
    res = 0
    user_list = []
    dowhile = True
    try:
        while res or dowhile:
            dowhile = False
            (users, _, res) = win32net.NetUserEnum(
                None,
                0,
                win32netcon.FILTER_NORMAL_ACCOUNT,
                res,
                win32netcon.MAX_PREFERRED_LENGTH
            )
            for user in users:
                user_list.append(user[&apos;name&apos;])
        return user_list
    except win32net.error:
        pass


def rename(name, new_name):
    &apos;&apos;&apos;
    Change the username for a named user

    Args:
        name (str): The user name to change

        new_name (str): The new name for the current user

    Returns:
        bool: True if successful, otherwise False

    CLI Example:

    .. code-block:: bash

        salt &apos;*&apos; user.rename jsnuffy jshmoe
    &apos;&apos;&apos;
    if six.PY2:
        name = _to_unicode(name)
        new_name = _to_unicode(new_name)

    # Load information for the current name
    current_info = info(name)
    if not current_info:
        raise CommandExecutionError(&apos;User \&apos;{0}\&apos; does not exist&apos;.format(name))

    # Look for an existing user with the new name
    new_info = info(new_name)
    if new_info:
        raise CommandExecutionError(
            &apos;User \&apos;{0}\&apos; already exists&apos;.format(new_name)
        )

    # Rename the user account
    # Connect to WMI
    pythoncom.CoInitialize()
    c = wmi.WMI(find_classes=0)

    # Get the user object
    try:
        user = c.Win32_UserAccount(Name=name)[0]
    except IndexError:
        raise CommandExecutionError(&apos;User \&apos;{0}\&apos; does not exist&apos;.format(name))

    # Rename the user
    result = user.Rename(new_name)[0]

    # Check the result (0 means success)
    if not result == 0:
        # Define Error Dict
        error_dict = {0: &apos;Success&apos;,
                      1: &apos;Instance not found&apos;,
                      2: &apos;Instance required&apos;,
                      3: &apos;Invalid parameter&apos;,
                      4: &apos;User not found&apos;,
                      5: &apos;Domain not found&apos;,
                      6: &apos;Operation is allowed only on the primary domain controller of the domain&apos;,
                      7: &apos;Operation is not allowed on the last administrative account&apos;,
                      8: &apos;Operation is not allowed on specified special groups: user, admin, local, or guest&apos;,
                      9: &apos;Other API error&apos;,
                      10: &apos;Internal error&apos;}
        raise CommandExecutionError(
            &apos;There was an error renaming \&apos;{0}\&apos; to \&apos;{1}\&apos;. Error: {2}&apos;
            .format(name, new_name, error_dict[result])
        )

    return info(new_name).get(&apos;name&apos;) == new_name


def current(sam=False):
    &apos;&apos;&apos;
    Get the username that salt-minion is running under. If salt-minion is
    running as a service it should return the Local System account. If salt is
    running from a command prompt it should return the username that started the
    command prompt.

    .. versionadded:: 2015.5.6

    Args:
        sam (bool, optional): False returns just the username without any domain
            notation. True returns the domain with the username in the SAM
            format. Ie: ``domain\\username``

    Returns:
        str: Returns username

    CLI Example:

    .. code-block:: bash

        salt &apos;*&apos; user.current
    &apos;&apos;&apos;
    try:
        if sam:
            user_name = win32api.GetUserNameEx(win32con.NameSamCompatible)
        else:
            user_name = win32api.GetUserName()
    except pywintypes.error as exc:
        log.error(&apos;Failed to get current user&apos;)
        log.error(&apos;nbr: %s&apos;, exc.winerror)
        log.error(&apos;ctx: %s&apos;, exc.funcname)
        log.error(&apos;msg: %s&apos;, exc.strerror)
        raise CommandExecutionError(&apos;Failed to get current user&apos;, info=exc)

    if not user_name:
        raise CommandExecutionError(&apos;Failed to get current user&apos;)

    return user_name
</code></pre><blockquote>
<p><a href="https://fossies.org/linux/salt/salt/modules/win_useradd.py">参考资料</a></p>
</blockquote>

        </div>
        
          


  <section class="meta" id="footer-meta">
    <hr>
    <div class="new-meta-box">
      
        
          <div class="new-meta-item date" itemprop="dateUpdated" datetime="2019-08-16T19:56:43+08:00">
  <a class="notlink">
    <i class="fas fa-clock" aria-hidden="true"></i>
    <p>最后更新于 2019年8月16日</p>
  </a>
</div>

        
      
        
          
  
  <div class="new-meta-item meta-tags"><a class="tag" href="/tags/python-win32net-Windows-Users/" rel="nofollow"><i class="fas fa-hashtag" aria-hidden="true"></i>&nbsp;<p>python win32net Windows Users</p></a></div>


        
      
        
          
  <div class="new-meta-item share -mob-share-list">
  <div class="-mob-share-list share-body">
    
      
        <a class="-mob-share-qq" title="QQ好友" rel="external nofollow noopener noreferrer" href="http://connect.qq.com/widget/shareqq/index.html?url=https://www.172173.com/python-win32net.html&title=python-win32net | 云运维&summary=python windows 用户管理
python win32net 模块,添加系统用户，以及赋权限。用于场景，VPN批量增加用户，共享增加用户，挺好用的。这边最需要注意的是赋权，是分两步走的。

第一步，创建用户1win32net.NetUserAdd(None, 1, udata)
第二部，加组1win32net.NetLocalGroupAddMembers(serverName, group_name, 3, [u])
第三步，赋权1win32net.NetUserSetInfo(None, u_name, 4, user_info)">
          
            <img src="https://cdn.jsdelivr.net/gh/xaoxuu/assets@19.1.9/logo/128/qq.png">
          
        </a>
      
    
      
        <a class="-mob-share-qzone" title="QQ空间" rel="external nofollow noopener noreferrer" href="https://sns.qzone.qq.com/cgi-bin/qzshare/cgi_qzshare_onekey?url=https://www.172173.com/python-win32net.html&title=python-win32net | 云运维&summary=python windows 用户管理
python win32net 模块,添加系统用户，以及赋权限。用于场景，VPN批量增加用户，共享增加用户，挺好用的。这边最需要注意的是赋权，是分两步走的。

第一步，创建用户1win32net.NetUserAdd(None, 1, udata)
第二部，加组1win32net.NetLocalGroupAddMembers(serverName, group_name, 3, [u])
第三步，赋权1win32net.NetUserSetInfo(None, u_name, 4, user_info)">
          
            <img src="https://cdn.jsdelivr.net/gh/xaoxuu/assets@19.1.9/logo/128/qzone.png">
          
        </a>
      
    
      
        <a class="-mob-share-weibo" title="微博" rel="external nofollow noopener noreferrer" href="http://service.weibo.com/share/share.php?url=https://www.172173.com/python-win32net.html&title=python-win32net | 云运维&summary=python windows 用户管理
python win32net 模块,添加系统用户，以及赋权限。用于场景，VPN批量增加用户，共享增加用户，挺好用的。这边最需要注意的是赋权，是分两步走的。

第一步，创建用户1win32net.NetUserAdd(None, 1, udata)
第二部，加组1win32net.NetLocalGroupAddMembers(serverName, group_name, 3, [u])
第三步，赋权1win32net.NetUserSetInfo(None, u_name, 4, user_info)">
          
            <img src="https://cdn.jsdelivr.net/gh/xaoxuu/assets@19.1.9/logo/128/weibo.png">
          
        </a>
      
    
  </div>
</div>



        
      
    </div>
  </section>


        
        
            <div class="prev-next">
                
                    <section class="prev">
                        <span class="art-item-left">
                            <h6><i class="fas fa-chevron-left" aria-hidden="true"></i>&nbsp;上一页</h6>
                            <h4>
                                <a href="/yum-errno-256.html" rel="prev" title="yum-errno-256">
                                  
                                      yum-errno-256
                                  
                                </a>
                            </h4>
                            
                                
                                <h6 class="tags">
                                    <a class="tag" href="/tags/yum-update-Errno-256/"><i class="fas fa-hashtag fa-fw" aria-hidden="true"></i>yum update Errno 256</a>
                                </h6>
                            
                        </span>
                    </section>
                
                
                    <section class="next">
                        <span class="art-item-right" aria-hidden="true">
                            <h6>下一页&nbsp;<i class="fas fa-chevron-right" aria-hidden="true"></i></h6>
                            <h4>
                                <a href="/filebeat.html" rel="prev" title="filebeat">
                                    
                                        filebeat
                                    
                                </a>
                            </h4>
                            
                                
                                <h6 class="tags">
                                    <a class="tag" href="/tags/filebeat-install/"><i class="fas fa-hashtag fa-fw" aria-hidden="true"></i>filebeat install</a>
                                </h6>
                            
                        </span>
                    </section>
                
            </div>
        
      </section>
    </article>
  

  
    <!-- 显示推荐文章和评论 -->



  <article class="post white-box comments">
    <section class="article typo">
      <h4><i class="fas fa-comments fa-fw" aria-hidden="true"></i>&nbsp;评论</h4>
      
      
      
      
        <section id="comments">
          <div id="valine_container" class="valine_thread">
            <i class="fas fa-spinner fa-spin fa-fw"></i>
          </div>
        </section>
      
    </section>
  </article>


  




<!-- 根据页面mathjax变量决定是否加载MathJax数学公式js -->



  <script>
    window.subData = {
      title: 'python-win32net',
      tools: true
    }
  </script>


</div>
<aside class="l_side">
  
    
    
      
        
          
          
            <section class="widget author">
  <div class="content pure">
    
      <div class="avatar">
        <img class="avatar" src="https://res.cloudinary.com/www-172173-com/image/upload/v1565838363/IMG_1014_ctdjly.jpg">
      </div>
    
    
    
      <div class="social-wrapper">
        
          
            <a href="/atom.xml" class="social fas fa-rss flat-btn" target="_blank" rel="external nofollow noopener noreferrer">
            </a>
          
        
          
            <a href="mailto:me@xaoxuu.com" class="social fas fa-envelope flat-btn" target="_blank" rel="external nofollow noopener noreferrer">
            </a>
          
        
          
            <a href="https://github.com/xaoxuu" class="social fab fa-github flat-btn" target="_blank" rel="external nofollow noopener noreferrer">
            </a>
          
        
          
            <a href="https://music.163.com/#/user/home?id=63035382" class="social fas fa-headphones-alt flat-btn" target="_blank" rel="external nofollow noopener noreferrer">
            </a>
          
        
      </div>
    
  </div>
</section>

          
        
      
        
          
          
            
  <section class="widget toc-wrapper">
    
<header class="pure">
  <div><i class="fas fa-list fa-fw" aria-hidden="true"></i>&nbsp;&nbsp;本文目录</div>
  
    <div class="wrapper"><a class="s-toc rightBtn" rel="external nofollow noopener noreferrer" href="javascript:void(0)"><i class="fas fa-thumbtack fa-fw"></i></a></div>
  
</header>

    <div class="content pure">
      <ol class="toc"><li class="toc-item toc-level-3"><a class="toc-link" href="#python-windows-用户管理"><span class="toc-text">python windows 用户管理</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#第一步，创建用户"><span class="toc-text">第一步，创建用户</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#第二部，加组"><span class="toc-text">第二部，加组</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#第三步，赋权"><span class="toc-text">第三步，赋权</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#代码"><span class="toc-text">代码</span></a></li></ol>
    </div>
  </section>


          
        
      
        
          
          
            <section class="widget grid">
  
<header class="pure">
  <div><i class="fas fa-map-signs fa-fw" aria-hidden="true"></i>&nbsp;&nbsp;站内导航</div>
  
</header>

  <div class="content pure">
    <ul class="grid navgation">
      
        <li><a class="flat-box" title="/" href="/" id="home">
          
            <i class="fas fa-clock fa-fw" aria-hidden="true"></i>
          
          近期文章
        </a></li>
      
        <li><a class="flat-box" title="/archives/" href="/archives/" rel="nofollow" id="archives">
          
            <i class="fas fa-archive fa-fw" aria-hidden="true"></i>
          
          文章归档
        </a></li>
      
        <li><a class="flat-box" title="/categories" href="/categories" id="categories">
          
            <i class="fas fa-code-branch fa-fw" aria-hidden="true"></i>
          
          文章分类
        </a></li>
      
        <li><a class="flat-box" title="/friends/" href="/friends/" rel="nofollow" id="friends">
          
            <i class="fas fa-link fa-fw" aria-hidden="true"></i>
          
          我的友链
        </a></li>
      
        <li><a class="flat-box" title="/about/" href="/about/" rel="nofollow" id="about">
          
            <i class="fas fa-info-circle fa-fw" aria-hidden="true"></i>
          
          关于小站
        </a></li>
      
    </ul>
  </div>
</section>

          
        
      
        
          
          
            
  <section class="widget category">
    
<header class="pure">
  <div><i class="fas fa-folder-open fa-fw" aria-hidden="true"></i>&nbsp;&nbsp;文章分类</div>
  
    <a class="rightBtn" rel="nofollow" href="/blog/categories/" title="blog/categories/">
    <i class="fas fa-expand-arrows-alt fa-fw"></i></a>
  
</header>

    <div class="content pure">
      <ul class="entry">
        
          <li><a class="flat-box" title="/categories/Linux/" href="/categories/Linux/"><div class="name">Linux</div><div class="badge">(29)</div></a></li>
        
          <li><a class="flat-box" title="/categories/Mac/" href="/categories/Mac/"><div class="name">Mac</div><div class="badge">(1)</div></a></li>
        
          <li><a class="flat-box" title="/categories/Python/" href="/categories/Python/"><div class="name">Python</div><div class="badge">(4)</div></a></li>
        
          <li><a class="flat-box" title="/categories/Redis/" href="/categories/Redis/"><div class="name">Redis</div><div class="badge">(8)</div></a></li>
        
          <li><a class="flat-box" title="/categories/SVN/" href="/categories/SVN/"><div class="name">SVN</div><div class="badge">(8)</div></a></li>
        
          <li><a class="flat-box" title="/categories/Ubuntu/" href="/categories/Ubuntu/"><div class="name">Ubuntu</div><div class="badge">(1)</div></a></li>
        
          <li><a class="flat-box" title="/categories/Windows/" href="/categories/Windows/"><div class="name">Windows</div><div class="badge">(7)</div></a></li>
        
          <li><a class="flat-box" title="/categories/工具/" href="/categories/工具/"><div class="name">工具</div><div class="badge">(1)</div></a></li>
        
          <li><a class="flat-box" title="/categories/闲谈/" href="/categories/闲谈/"><div class="name">闲谈</div><div class="badge">(3)</div></a></li>
        
      </ul>
    </div>
  </section>


          
        
      
        
          
          
            
  <section class="widget tagcloud">
    
<header class="pure">
  <div><i class="fas fa-fire fa-fw" aria-hidden="true"></i>&nbsp;&nbsp;热门标签</div>
  
    <a class="rightBtn" rel="nofollow" href="/blog/tags/" title="blog/tags/">
    <i class="fas fa-expand-arrows-alt fa-fw"></i></a>
  
</header>

    <div class="content pure">
      <a href="/tags/Django基础之form表单的所有内置字段/" style="font-size: 14px; color: #999">Django基础之form表单的所有内置字段</a> <a href="/tags/ERROR-matplotlib-1-3-1-requires-nose/" style="font-size: 14px; color: #999">ERROR: matplotlib 1.3.1 requires nose</a> <a href="/tags/IIS7-配置备份还原/" style="font-size: 14px; color: #999">IIS7 配置备份还原</a> <a href="/tags/Kafka-REST-Proxy/" style="font-size: 14px; color: #999">Kafka REST Proxy</a> <a href="/tags/Linux-安全/" style="font-size: 14px; color: #999">Linux 安全</a> <a href="/tags/Linux主机初始化/" style="font-size: 14px; color: #999">Linux主机初始化</a> <a href="/tags/Nexus3/" style="font-size: 14px; color: #999">Nexus3</a> <a href="/tags/Nexus3-docker/" style="font-size: 14px; color: #999">Nexus3 docker</a> <a href="/tags/PHP-install-from-source/" style="font-size: 14px; color: #999">PHP install from source</a> <a href="/tags/Pure-ftp/" style="font-size: 14px; color: #999">Pure ftp</a> <a href="/tags/Redis-backup/" style="font-size: 14px; color: #999">Redis backup</a> <a href="/tags/Redis-info/" style="font-size: 14px; color: #999">Redis info</a> <a href="/tags/Redis-install/" style="font-size: 14px; color: #999">Redis install</a> <a href="/tags/Redis-master-slave/" style="font-size: 14px; color: #999">Redis master slave</a> <a href="/tags/Redis-slowlog/" style="font-size: 14px; color: #999">Redis slowlog</a> <a href="/tags/Redis-zabbix/" style="font-size: 14px; color: #999">Redis zabbix</a> <a href="/tags/Redis-密码设置/" style="font-size: 14px; color: #999">Redis 密码设置</a> <a href="/tags/Redis-过期-key/" style="font-size: 14px; color: #999">Redis 过期 key</a> <a href="/tags/Rsyslog/" style="font-size: 24px; color: #555">Rsyslog</a> <a href="/tags/Rsyslog-logger/" style="font-size: 14px; color: #999">Rsyslog logger</a> <a href="/tags/Rsyslog-日志转发/" style="font-size: 14px; color: #999">Rsyslog 日志转发</a> <a href="/tags/Shadowsocks/" style="font-size: 14px; color: #999">Shadowsocks</a> <a href="/tags/TMG-vpn-windows-Forefront-TMG-2010/" style="font-size: 14px; color: #999">TMG vpn windows Forefront TMG 2010</a> <a href="/tags/Ubuntu-安全/" style="font-size: 14px; color: #999">Ubuntu 安全</a> <a href="/tags/VPN-错误原因-找不到证书/" style="font-size: 14px; color: #999">VPN 错误原因: 找不到证书</a> <a href="/tags/Win2008-R2实现多用户远程连接设置方法/" style="font-size: 24px; color: #555">Win2008 R2实现多用户远程连接设置方法</a> <a href="/tags/charles/" style="font-size: 14px; color: #999">charles</a> <a href="/tags/filebeat-install/" style="font-size: 14px; color: #999">filebeat install</a> <a href="/tags/hexo-GitHub/" style="font-size: 14px; color: #999">hexo GitHub</a> <a href="/tags/hexo-valine-LeanCloud/" style="font-size: 14px; color: #999">hexo valine LeanCloud</a> <a href="/tags/https-Certbot-Let’s-Encrypt/" style="font-size: 14px; color: #999">https Certbot Let’s Encrypt</a> <a href="/tags/jenkins-install/" style="font-size: 14px; color: #999">jenkins install</a> <a href="/tags/kafka-install/" style="font-size: 14px; color: #999">kafka install</a> <a href="/tags/lsyncd/" style="font-size: 14px; color: #999">lsyncd</a> <a href="/tags/material-x/" style="font-size: 14px; color: #999">material-x</a> <a href="/tags/nginx-install/" style="font-size: 14px; color: #999">nginx install</a> <a href="/tags/nginx-ocsp/" style="font-size: 14px; color: #999">nginx ocsp</a> <a href="/tags/nginx-rewrite/" style="font-size: 14px; color: #999">nginx rewrite</a> <a href="/tags/nginx-ssl/" style="font-size: 14px; color: #999">nginx ssl</a> <a href="/tags/nginx-tcp/" style="font-size: 14px; color: #999">nginx tcp</a> <a href="/tags/openswan/" style="font-size: 14px; color: #999">openswan</a> <a href="/tags/python-re-正则表达式/" style="font-size: 14px; color: #999">python re 正则表达式</a> <a href="/tags/python-win32net-Windows-Users/" style="font-size: 14px; color: #999">python win32net Windows Users</a> <a href="/tags/sersync/" style="font-size: 14px; color: #999">sersync</a> <a href="/tags/supervisord/" style="font-size: 14px; color: #999">supervisord</a> <a href="/tags/svn/" style="font-size: 14px; color: #999">svn</a> <a href="/tags/svn-backup/" style="font-size: 14px; color: #999">svn backup</a> <a href="/tags/svn-hook/" style="font-size: 14px; color: #999">svn hook</a> <a href="/tags/svn-http/" style="font-size: 14px; color: #999">svn http</a> <a href="/tags/svn-install/" style="font-size: 14px; color: #999">svn install</a> <a href="/tags/svn-master-slave/" style="font-size: 14px; color: #999">svn master slave</a> <a href="/tags/svn-submin/" style="font-size: 14px; color: #999">svn submin</a> <a href="/tags/svnmanger/" style="font-size: 14px; color: #999">svnmanger</a> <a href="/tags/vpn-openvpn-Ipsec-OpenSWan/" style="font-size: 14px; color: #999">vpn openvpn Ipsec OpenSWan</a> <a href="/tags/yum-update-Errno-256/" style="font-size: 14px; color: #999">yum update Errno 256</a> <a href="/tags/七牛云-Bucket-空间域名/" style="font-size: 14px; color: #999">七牛云 Bucket 空间域名</a> <a href="/tags/八荣八耻-云运维-devops/" style="font-size: 14px; color: #999">八荣八耻 云运维 devops</a> <a href="/tags/各家云服务器商的对比/" style="font-size: 14px; color: #999">各家云服务器商的对比</a> <a href="/tags/磁盘清理/" style="font-size: 14px; color: #999">磁盘清理</a> <a href="/tags/连接无法继续，因为未启用身份验证/" style="font-size: 14px; color: #999">连接无法继续，因为未启用身份验证</a>
    </div>
  </section>


          
        
      
        
          
          
            



          
        
      
    

  
</aside>

<footer id="footer" class="clearfix">
  
  
    <div class="social-wrapper">
      
        
          <a href="/atom.xml" class="social fas fa-rss flat-btn" target="_blank" rel="external nofollow noopener noreferrer">
          </a>
        
      
        
          <a href="mailto:me@xaoxuu.com" class="social fas fa-envelope flat-btn" target="_blank" rel="external nofollow noopener noreferrer">
          </a>
        
      
        
          <a href="https://github.com/xaoxuu" class="social fab fa-github flat-btn" target="_blank" rel="external nofollow noopener noreferrer">
          </a>
        
      
        
          <a href="https://music.163.com/#/user/home?id=63035382" class="social fas fa-headphones-alt flat-btn" target="_blank" rel="external nofollow noopener noreferrer">
          </a>
        
      
    </div>
  
  <br>
  <div><p>Copyright © 2019 | 版权所有 <a href="http://fj.beian.miit.gov.cn/publish/query/indexFirst.action;jsessionid=075DA6F247D146C9201341C9B5A740CF">闽IC P备18011948号</a></p>
</div>
  <div>
    本站使用
    <a href="https://www.172173.com/about" target="_blank" class="codename">172173.com</a>
    作为主题
    
      ，
      总访问量为
      <span id="busuanzi_value_site_pv"><i class="fas fa-spinner fa-spin fa-fw" aria-hidden="true"></i></span>
      次
    
    。
  </div>
</footer>
<script>setLoadingBarProgress(80);</script>
<script type="text/javascript" src="/cool/banner.js"></script>


      <script>setLoadingBarProgress(60);</script>
    </div>
    <a class="s-top fas fa-arrow-up fa-fw" href='javascript:void(0)'></a>
  </div>
  <script src="https://cdn.jsdelivr.net/npm/jquery@3.3.1/dist/jquery.min.js"></script>

  <script>
    var GOOGLE_CUSTOM_SEARCH_API_KEY = "";
    var GOOGLE_CUSTOM_SEARCH_ENGINE_ID = "";
    var ALGOLIA_API_KEY = "";
    var ALGOLIA_APP_ID = "";
    var ALGOLIA_INDEX_NAME = "";
    var AZURE_SERVICE_NAME = "";
    var AZURE_INDEX_NAME = "";
    var AZURE_QUERY_KEY = "";
    var BAIDU_API_ID = "";
    var SEARCH_SERVICE = "hexo" || "hexo";
    var ROOT = "/"||"/";
    if(!ROOT.endsWith('/'))ROOT += '/';
  </script>

<script src="//instant.page/1.2.2" type="module" integrity="sha384-2xV8M5griQmzyiY3CDqh1dn4z3llDVqZDqzjzcY+jCBCk/a5fXJmuZ/40JJAPeoU"></script>


  <script async src="https://cdn.jsdelivr.net/npm/scrollreveal@4.0.5/dist/scrollreveal.min.js"></script>
  <script type="text/javascript">
    $(function() {
      const $reveal = $('.reveal');
      if ($reveal.length === 0) return;
      const sr = ScrollReveal({ distance: 0 });
      sr.reveal('.reveal');
    });
  </script>


  <script src="https://cdn.jsdelivr.net/npm/node-waves@0.7.6/dist/waves.min.js"></script>
  <script type="text/javascript">
    $(function() {
      Waves.attach('.flat-btn', ['waves-button']);
      Waves.attach('.float-btn', ['waves-button', 'waves-float']);
      Waves.attach('.float-btn-light', ['waves-button', 'waves-float', 'waves-light']);
      Waves.attach('.flat-box', ['waves-block']);
      Waves.attach('.float-box', ['waves-block', 'waves-float']);
      Waves.attach('.waves-image');
      Waves.init();
    });
  </script>


  <script async src="https://cdn.jsdelivr.net/gh/xaoxuu/cdn-busuanzi@2.3/js/busuanzi.pure.mini.js"></script>




  
  
  
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-backstretch/2.0.4/jquery.backstretch.min.js"></script>
    <script type="text/javascript">
      $(function(){
        if ('.cover') {
          $('.cover').backstretch(
          ["https://res.cloudinary.com/www-172173-com/image/upload/v1566033053/IMG_1022_bvt23k.jpg"],
          {
            duration: "6000",
            fade: "2500"
          });
        } else {
          $.backstretch(
          ["https://res.cloudinary.com/www-172173-com/image/upload/v1566033053/IMG_1022_bvt23k.jpg"],
          {
            duration: "6000",
            fade: "2500"
          });
        }
      });
    </script>
  









  <script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script>
  
    
      <script src="https://cdn.jsdelivr.net/gh/xaoxuu/volantis@1.0/js/volantis.min.js"></script>
    
  
  <script>
  var GUEST_INFO = ['nick','mail','link'];
  var guest_info = 'nick,mail,link'.split(',').filter(function(item){
    return GUEST_INFO.indexOf(item) > -1
  });
  var notify = 'true' == true;
  var verify = 'true' == true;
  var valine = new Valine();
  valine.init({
    el: '#valine_container',
    notify: notify,
    verify: verify,
    guest_info: guest_info,
    
    appId: "xFcujt6m2KQvPvjBxRVRiD6R-gzGzoHsz",
    appKey: "wn426D29iJpKjYczYLBPPCiP",
    placeholder: "快来评论吧~",
    pageSize:'10',
    avatar:'mp',
    lang:'zh-cn',
    highlight:'false'
  })
  </script>



  <script src="https://cdn.jsdelivr.net/gh/xaoxuu/cdn-material-x@19.5/js/app.js"></script>


  <script src="https://cdn.jsdelivr.net/gh/xaoxuu/cdn-material-x@19.5/js/search.js"></script>




<!-- 复制 -->
<script src="https://cdn.jsdelivr.net/npm/clipboard@2/dist/clipboard.min.js"></script>
<script>
  let COPY_SUCCESS = "复制成功";
  let COPY_FAILURE = "复制失败";
  /*页面载入完成后，创建复制按钮*/
  !function (e, t, a) {
    /* code */
    var initCopyCode = function(){
      var copyHtml = '';
      copyHtml += '<button class="btn-copy" data-clipboard-snippet="">';
      copyHtml += '  <i class="fa fa-copy"></i><span>复制</span>';
      copyHtml += '</button>';
      $(".highlight .code pre").before(copyHtml);
      var clipboard = new ClipboardJS('.btn-copy', {
        target: function(trigger) {
          return trigger.nextElementSibling;
        }
      });

      clipboard.on('success', function(e) {
        //您可以加入成功提示
        console.info('Action:', e.action);
        console.info('Text:', e.text);
        console.info('Trigger:', e.trigger);
        success_prompt(COPY_SUCCESS);
        e.clearSelection();
      });
      clipboard.on('error', function(e) {
        //您可以加入失败提示
        console.error('Action:', e.action);
        console.error('Trigger:', e.trigger);
        fail_prompt(COPY_FAILURE);
      });
    }
    initCopyCode();

  }(window, document);

  /**
   * 弹出式提示框，默认1.5秒自动消失
   * @param message 提示信息
   * @param style 提示样式，有alert-success、alert-danger、alert-warning、alert-info
   * @param time 消失时间
   */
  var prompt = function (message, style, time)
  {
      style = (style === undefined) ? 'alert-success' : style;
      time = (time === undefined) ? 1500 : time*1000;
      $('<div>')
          .appendTo('body')
          .addClass('alert ' + style)
          .html(message)
          .show()
          .delay(time)
          .fadeOut();
  };

  // 成功提示
  var success_prompt = function(message, time)
  {
      prompt(message, 'alert-success', time);
  };

  // 失败提示
  var fail_prompt = function(message, time)
  {
      prompt(message, 'alert-danger', time);
  };

  // 提醒
  var warning_prompt = function(message, time)
  {
      prompt(message, 'alert-warning', time);
  };

  // 信息提示
  var info_prompt = function(message, time)
  {
      prompt(message, 'alert-info', time);
  };

</script>


<!-- fancybox -->
<script src="https://cdn.jsdelivr.net/gh/fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.js"></script>
<script>
  let LAZY_LOAD_IMAGE = "[object Object]";
  $(".article-entry").find("fancybox").find("img").each(function () {
      var element = document.createElement("a");
      $(element).attr("data-fancybox", "gallery");
      $(element).attr("href", $(this).attr("src"));
      /* 图片采用懒加载处理时,
       * 一般图片标签内会有个属性名来存放图片的真实地址，比如 data-original,
       * 那么此处将原本的属性名src替换为对应属性名data-original,
       * 修改如下
       */
       if (LAZY_LOAD_IMAGE) {
         $(element).attr("href", $(this).attr("data-original"));
       }
      $(this).wrap(element);
  });
</script>





  <script>setLoadingBarProgress(100);</script>
</body>
</html>
